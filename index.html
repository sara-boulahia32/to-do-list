<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To-Do List</title>
    <link href="output.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Istok+Web:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
    <style>
        .picture-cover{
            background-image: url(image/a614b8c617c651ff2832e109ce447de0\ 1.png);
            background-position: center;
            background-size: cover;
            width: 100%;
            height: 40vh;
        }
        
        
        .dropdown-menu {
            max-height: 200px;
            overflow-y: auto;
            overflow-x: hidden;
        }
        .task {
            border-radius: .5rem;
            border: 1px solid #CFC099;
            border-left-width: 7.5px;
            padding: .75rem 1rem;
            margin-bottom: 1.3rem;

            & h6 {
                color: rgba(0, 0, 0, .7);
                word-break: break-all;
            }
        }
        .border-red {
            border-left-color: red; /* P1 */
        }
        .border-orange {
            border-left-color: orange; /* P2 */
        }
        .border-green {
            border-left-color: green; /* P3 */
        }
        .w-fit {
            width: fit-content;
        }

        body {
            position: relative;
            min-height: 100vh;
        }
        .left-20vw {
            left: 37vw;
        }
        .top-40vw {
            top: 10vw;
        }
        .letterspacing{
            letter-spacing: 1px;
        }
    </style>
</head>

<body class="relative bg-customCream px-[100px]">

    <section class="picture-cover"></section>
    <section class=" my-[50px]">
        <div class="flex justify-between mb-10">
            <div class="relative">
                <div id="searchBar" class="col-8">
                    <input type="text" placeholder="Search task.."
                    class="border border-customGray shadow-lg rounded-3xl py-2 pl-2 h-16 focus:outline-none focus:ring-2 focus:ring-customBrown text-2xl font-bold">
                </div>
                <div class="absolute inset-y-0 right-3 pl-3 flex items-center pointer-events-none">
                    <svg class="h-10 w-10 text-gray-400" fill="none" stroke-linecap="round" stroke-linejoin="round"
                        stroke-width="2" viewBox="0 0 24 24" stroke="currentColor">
                        <path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                </div>
            </div>
            <button id="openAjoute" class="text-6xl bg-customBrown hover:scale-110 font-bold rounded-3xl w-[80px] h-[80px] ">+</button>
        </div>

        <div class="grid grid-cols-3 gap-[50px]">
            <div>
                <h2 class="text-6xl font-bold text-customBlue mb-3">To do | <span id="todo-count">0</span></h2>
                <hr class="border-customBlue mb-3">
                <div id="todo-tasks">
                    </div>
            </div>
            <div>
                <h2 class="text-6xl font-bold text-customGreen mb-3">In progress | <span id="inprogress-count">0</span></h2>
                <hr class="border-customGreen mb-5">
                <div id="inprogress-tasks">
                    </div>
            </div>
            <div>
                <h2 class="text-6xl font-bold text-customPink mb-3">Done | <span id="done-count">0</span></h2>
                <hr class="border-customPink mb-5">
                <div id="done-tasks">
                    </div>
            </div>
        </div>
    </section>
    <section>
    <form id="createTaskPopup" class="absolute top-40vw left-20vw w-[800px] h-[950px] flex flex-col gap-[40px] bg-customBrown px-[100px] rounded-3xl hidden ">
            <div id="closeIcon" class=" flex justify-end">
                <span role="button" class="text-5xl font-bold cursor-pointer mt-2">x</span>
            </div>
            <p id="alert" class="hidden text-2xl text-red-500 text-center py-1">Please fill all the fields.</p>
            
            <div class="mb-4 text-3xl font-bold">
                <label for="title">Title:</label>
                <input type="text" name="title" id="title" 
                    class="w-full border border-customGray shadow-lg rounded-3xl py-2 pl-2 h-[100px] focus:outline-none focus:ring-2 focus:ring-black">    
            </div>

            <div class="mb-4 text-3xl font-bold">
                <label for="description">Description:</label>
                <textarea id="description" rows="3"
                    class="w-full border border-customGray shadow-lg rounded-3xl py-2 pl-2 h-[200px] focus:outline-none focus:ring-2 focus:ring-black"></textarea>
            </div>
            <div class="mb-4 text-2xl font-bold">
                <label for="title">Date:</label>
                <input type="date" name="title" id="date" 
                    class="w-full border border-customGray shadow-lg rounded-3xl py-2 pl-2 h-12 focus:outline-none focus:ring-2 focus:ring-black">    
            </div>

            <div class="mb-4 ">
                <div class="flex gap-4 text-3xl font-bold">
                    <div id="priority-menu" class="relative">
                        <button class="w-[200px]  bg-white h-[70px] border border-black rounded-xl px-2 py-1">
                            Priority
                        </button>
                        <div class="hidden absolute mt-1 w-full bg-white border rounded-lg shadow-lg">
                            <button value="0" class="block w-full px-4 py-2 hover:bg-gray-100">P1</button>
                            <button value="1" class="block w-full px-4 py-2 hover:bg-gray-100">P2</button>
                            <button value="2" class="block w-full px-4 py-2 hover:bg-gray-100">P3</button>
                        </div>
                    </div>
                    <div id="state-menu" class="relative">
                        <button class="w-[200px] bg-white h-[70px]  border border-black rounded-xl px-2 py-1">
                            State
                        </button>
                        <div class="hidden absolute mt-1 w-full bg-white border rounded-lg shadow-lg">
                            <button value="0" class="block w-full px-4 py-2 hover:bg-gray-100">To Do</button>
                            <button value="1" class="block w-full px-4 py-2 hover:bg-gray-100">Doing</button>
                            <button value="2" class="block w-full px-4 py-2 hover:bg-gray-100">Completed</button>
                        </div>
                    </div>
                </div>
            </div>

            <button class="self-end w-[200px]  px-3 py-[20px] text-3xl bg-black text-white rounded-lg hover:bg-white hover:text-black hover:font-bold letterspacing">Save</button>
        </form>
    
<script>
    // DOM Elements

    
    const createTaskPopup = document.getElementById('createTaskPopup');
    const closeButton = document.querySelector('#closeIcon span');
    const form = document.querySelector('form');
    const alert = document.getElementById('alert');
    
    // Task containers
    const todoTasks = document.getElementById('todo-tasks');
    const inprogressTasks = document.getElementById('inprogress-tasks');
    const doneTasks = document.getElementById('done-tasks');
    
    // Counters
    const todoCount = document.getElementById('todo-count');
    const inprogressCount = document.getElementById('inprogress-count');
    const doneCount = document.getElementById('done-count');
    
    // Toggle popup
    const openAjoute = document.getElementById("openAjoute").addEventListener("click",()=>{
        createTaskPopup.classList.remove('hidden');
    })
    
    
    closeButton.addEventListener('click', () => {
        createTaskPopup.classList.add('hidden');
        form.reset();
        alert.classList.add('hidden');
    });

    // Handle dropdown menus priorité et status 
    const dropdowns = ['priority-menu', 'state-menu'];
    dropdowns.forEach(id => {
        const menu = document.getElementById(id);
        const button = menu.querySelector('button');
        const options = menu.querySelector('div');

        // selects all buttons inside the options div
        button.addEventListener('click', (e) => {
            e.preventDefault();
            options.classList.toggle('hidden');
        });

        //  loop through each option+ prevent default action update the text content to selected option +hide dropdown options again by adding hidden class 
        options.querySelectorAll('button').forEach(option => {
            option.addEventListener('click', (e) => {
                e.preventDefault();
                button.textContent = option.textContent;
                options.classList.add('hidden');
            });
        });
    });
    
    // Form submission 
    form.addEventListener('submit', (e) => {// listens for submit event, when the form is submitted, if input fields r valid, calls function to create new task 
        e.preventDefault();// prevent page relod 
        // retrieve form values 
        const title = document.getElementById('title').value;
        const description = document.getElementById('description').value;
        const priority = document.querySelector('#priority-menu button').textContent;
        const state = document.querySelector('#state-menu button').textContent;
        // check if empty 
        if (!title || !description || priority === 'Priority' || state === 'State') {
            alert.classList.remove('hidden'); // alert is visible by removing the hidden class 
            return;
        }
        // if all validated call function create task passing these arguments
        createTask(title, description, priority, state);
        // createTaskPopup.classList.add('hidden');
        form.reset();
        alert.classList.add('hidden');// alert is hidden now 
    });
    
    // function for creating a new task 4 arguments/parameters
    // create a new html element and popuolates it with the provided data 
    function createTask(title, description, priority, state) {
        // create the task element  
        const task = document.createElement('div');
        task.className = 'task';// for styling 
        
        // Set border color based on priority
        const borderColor = {
            'P1': 'border-red',
            'P2': 'border-orange',
            'P3': 'border-green'
        }[priority];// an object to define each priority class to css styling 
        
        task.classList.add(borderColor);
    
        task.innerHTML = `
            <h3 class="text-3xl font-bold mb-2">${title}</h3>
            <h6 class="text-2xl mb-3">${description}</h6>
            <div class="flex justify-between items-center">
                <span class="font-bold mb-2">${priority}</span>
                <select class="font-bold text-xl border rounded px-1">
                    <option ${state === 'To Do' ? 'selected' : ''}>To Do</option> // selected attribute if state to do is assigned 
                    <option ${state === 'Doing' ? 'selected' : ''}>Doing</option>
                    <option ${state === 'Completed' ? 'selected' : ''}>Completed</option>
                </select>
            </div>
        `;
    
        // Add task to status+update the corresponding status's count
        const container = {
            'To Do': todoTasks,// correspondre le task à l'ecriture affihé 
            'Doing': inprogressTasks,
            'Completed': doneTasks
        }[state];// accesses the value associated with the current task 
        
        // add below the appropriate task
        container.appendChild(task);
        updateCounts(); // add count 
    
        // lists to changes and handles them by moving tasks to their corresponding status
        const select = task.querySelector('select');// select drop down menu 
        select.addEventListener('change', () => {// event chenge triggered when the user selects a different option from the dropdown 
            const newContainer = {// similar to last one 
                'To Do': todoTasks,
                'Doing': inprogressTasks,
                'Completed': doneTasks
            }[select.value];
            
            newContainer.appendChild(task);
            updateCounts();
        });
    }
    
    function updateCounts() {
        todoCount.textContent = todoTasks.children.length;// accesses all tasks marked as to do and retrieves the number of child elemnts and displays them
        inprogressCount.textContent = inprogressTasks.children.length;// counting tasks in progress 
        doneCount.textContent = doneTasks.children.length;// similar 
    }
    
    // Search input changes in a search field 
    const searchInput = document.querySelector('input[type="text"]');
    searchInput.addEventListener('input', () => {
        const searchTerm = searchInput.value.toLowerCase();
        const tasks = document.querySelectorAll('.task');
    
        tasks.forEach(task => {
            const title = task.querySelector('h3').textContent.toLowerCase();
            const description = task.querySelector('h6').textContent.toLowerCase();
            
            if (title.includes(searchTerm) || description.includes(searchTerm)) {
                task.style.display = '';
            } else {
                task.style.display = 'none';
            }
        });
    });
    const searchFound = document.getElementById('searchBar');
    searchFound.addEventListener('input', () => {
        const searchTerm = searchFound.value.toLowerCase();
        const tasks = document.querySelectorAll('.task');
    
        tasks.forEach(task => {
            const title = task.querySelector('h3').textContent.toLowerCase();
            const description = task.querySelector('h6').textContent.toLowerCase();
            
            if (title.includes(searchTerm) || description.includes(searchTerm)) {
                task.style.display = '';
            } else {
                task.style.display = 'none';
            }
        });
    });
    </script>
    
</body>

</html>